# Расчет качества извлечения табличных данных
Проект для расчета качества извлечения табличных данных из документов на препроде 
(с отправкой в ПИМ на поиск координат таблиц). 
Сравнивает эталонные данные с распознанными и формирует детализированный отчет с метриками качества.

## **Предварительные требования**
1. Перед запуском основного скрипта необходимо выполнить выгрузку данных из базы данных.
Скрипт из БД подготавливает только файл с распознанными данными (INPUT_DATA_RECOGINIZED). 
Скрипт находится в корне проекта - ```db_data.txt```
2. Эталонные данные (INPUT_DATA_ETALON) должны быть подготовлены вручную.
3. Структура входных данных. В папке INPUT должны находиться два файла:
    + **Файл с эталонными данными** (INPUT_DATA_ETALON) Формат - Excel (.xlsx)
    Обязательные колонки:
      - Наименование файла с расширением
      - Параметр
      - Параметр с переводом
      - Эталонное значение

    + **Файл с распознанными данными** (INPUT_DATA_RECOGINIZED) - подготавливается скриптом из БД:
      - Может быть в формате CSV или Excel
      - Должен содержать колонку doc_type для определения типа документа

### Установка зависимостей
```txt
pandas==2.2.3
openpyxl==3.1.2
tabulate==0.9.0
```
### Запуск проекта
```txt
В PyCharm: запустите main.py
# Или через командную строку:
python main.py
```
### Подготовка данных
- Запустите скрипт выгрузки из БД для получения INPUT_DATA_RECOGINIZED
- Подготовьте файл INPUT_DATA_ETALON с эталонными данными
- Разместите оба файла в папке INPUT

## **Функциональность**
### Основные возможности
- Автоматическая обработка данных из БД - парсинг сырых данных из INPUT_DATA_RECOGINIZED
- Автоматическое определение структуры данных - определяет необходимость разворачивания данных
- Многоуровневая оценка качества:
  - Оценка на уровне ячеек
  - Оценка на уровне столбцов
  - Оценка на уровне файлов (пакетов)

### Поддерживаемые атрибуты таблиц
Система рассчитывает качество для атрибутов из TABLE_ATTRIBUTES (см. constants.py)

## **Процесс обработки данных**
### Для распознанных данных (из БД):
- Чтение - автоматическое определение формата (CSV/Excel) и кодировки
- Парсинг - преобразование сырых JSON-данных в структурированный формат
- Разворачивание - разделение значений с разделителем ; на отдельные строки

### Для эталонных данных:
- Чтение - загрузка из Excel файла
- Разворачивание - при необходимости разделение значений с разделителем ;

## **Структура отчета**
Создается Excel-файл с листами:

- Общая статистика - сводные метрики
- Детализация попакетно - подробная информация по файлам
- Детализация по колонкам - рейтинг качества по колонкам
- Эталонные значения - исходные эталонные данные
- Распознанные значения - результаты распознавания

## **Логирование**
- Логи выводятся в консоль
- Сохраняются в файл main.py.log
- Уровень логирования: DEBUG

## **Выходные данные**
Файл отчета: {название_шаблона}_report.xlsx
в папке OUTPUT/OUTPUT_REPORTS/

Структура проекта
```txt
project/
├── main.py                 # Основной скрипт
├── check_input_data.py     # Проверка входных данных
├── main_logic/
│   └── create_report.py    # Создание отчетов
├── utils/
│   ├── utils.py           # Вспомогательные функции
│   └── constants.py       # Константы и настройки
├── INPUT/                  # Входные данные
└── OUTPUT/                # Выходные данные
```
